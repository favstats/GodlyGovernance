$(function(){wp_pb=window.wp_pb||{};wp_pb.CommentLoader=wp_pb.CommentLoader||function(){var width=window.innerWidth>0?window.innerWidth:screen.width,isMobile=wp_pb&&wp_pb.BrowserInfo&&wp_pb.BrowserInfo.mobile_browser===1&&width<480?true:false,isArticle=$("html").hasClass("layout_article")?true:false,commentsClosed=$(".echo_container .closed").length>0?true:false,loadDeferred=$(".echo_container.defer").length>0?true:false,triggerLoad=$(".echo_container.triggerLoad").length>0?true:false,loadDeferredMobile=
$(".echo_container.deferMobile").length>0?true:false,noMobile=$(".echo_container.no-mobile").length>0&&isMobile?true:false,noDesktop=$(".echo_container.no-desktop").length>0?true:false,$window=$(window),$echoPlaceholder=$(".echo_container_placeholder"),loadThreshhold=.7,env=wp_pb.environment||"production",apiBaseURL=env=="production"?"https://comments-api.ext.nile.works":"https://comments-api-staging.ext.nile.works",forceShowComments=$(document).getUrlParam("sc"),commentOverlay={overlayElements:{overlay:"#comment_overlay",
articleWrapper:".article-wrapper",articleTopper:".article-topper",articleParent:".story-stream"},onClose:function(data){data.overlay=data.overlay||$(commentOverlay.overlayElements.overlay);data.overlay.addClass("overlay-closed")},onOpen:function(data){if($("body").is(".left-menu")){$("#site-menu-btn").click();setTimeout(function(){data.overlay.addClass("overlay-fixed").removeClass("overlay-absolute");data.overlayWrapper.removeClass("overlay-closed")},600)}else{data.overlay.addClass("overlay-fixed").removeClass("overlay-absolute");
data.overlayWrapper.removeClass("overlay-closed")}},onScroll:function(event){},closeSelector:"a.close"};var loadComments=function(){if(!noMobile&&!noDesktop&&$(".echo_container.stream").length>0)if(typeof wp_e2=="undefined"||typeof wp_e2.initStatus=="undefined"){var domain=env=="production"?"//www.washingtonpost.com/pb":"/pb";var outputtype=env=="production"?"\x26outputType\x3djavascript":"\x26outputType\x3djavascript";var resourceToken=wp_pb.resourceToken||"201504300950";var commentsFile=[domain+
"/1d/twp-comments.js"+"?token\x3d"+resourceToken+outputtype];window.wp_import&&wp_import(commentsFile)}};var showComments=function(data){loadComments();$window.off("scroll.showComments");var $overlay=$(commentOverlay.overlayElements.overlay);if($overlay.length===0){$(".comment-summary.summary-expanded, .comment-summary.summary-expanded-mobile, .comment-summary.summary-expanded-desktop").slideUp("fast",function(){$(".echo_container.comments-collapsed").removeClass("comments-collapsed").addClass("comments-expanded").slideDown("fast",
function(){wp_pb.report("global","domChanged")});$(this).addClass("summary-collapsed").removeClass("summary-expanded summary-expanded-mobile summary-expanded-desktop");if(typeof window.sendDataToOmniture==="function")try{sendDataToOmniture("echo.gotoComments","event5",{eVar26:"go to comments"})}catch(err){}});var bottomOffset=$(document).height()-$($echoPlaceholder.parent()[0]).offset().top;var windowHeight=$(window).height();if(bottomOffset<windowHeight)$($echoPlaceholder.parent()[0]).height(windowHeight-
bottomOffset);$echoPlaceholder.parent()[0].scrollIntoView()}else{if(typeof data=="undefined")return;$overlayWrapper=data.elm.parents(commentOverlay.overlayElements.articleWrapper);if(!$overlay.is(".overlay-closed"))wp_pb.report("comments","commentsMultiClosed",{overlay:$overlay,overlayWrapper:$overlayWrapper});else{$overlay.find(commentOverlay.closeSelector).on("click",function(event){event.stopPropagation();wp_pb.report("comments","commentsMultiClosed",{overlay:$overlay,overlayWrapper:$overlayWrapper})});
$overlayWrapper.after($overlay);var top=data&&data.location&&data.location.offset().top||$(document).scrollTop();if(typeof data.guid!=="undefined"){var allow_comments=$overlayWrapper.find(".pb-comment-wrapper").attr("data-allow-comments")==="true"?true:false;wp_e2.refreshComments({id:"#"+$overlay.find(".echo_container.comments").attr("id"),url:data.guid,allow_comments:allow_comments})}wp_pb.report("comments","commentsMultiOpened",{parent:$overlayWrapper.parent($(commentOverlay.overlayElements.articleParent)),
overlay:$overlay,overlayWrapper:$overlayWrapper})}}};var loadCommentCount=function(elms){var echoCountApi=apiBaseURL+"/v2/mux"+"?appkey\x3d"+(TWP.Data.echo_appkey!="undefined"?TWP.Data.echo_appkey:"prod.washpost.com")+"\x26requests\x3d";var query="(childrenof:'{guid}'"+encodeURI("source:washpost.com (((state:Untouched AND user.state:ModeratorApproved) OR (state:CommunityFlagged,ModeratorApproved,ModeratorDeleted AND -user.state:ModeratorBanned,ModeratorDeleted) )))"+" children: 2 (((state:Untouched AND user.state:ModeratorApproved) OR (state:CommunityFlagged,ModeratorApproved AND -user.state:ModeratorBanned,ModeratorDeleted) ) )");
var muxArray=new Array;var dataUrl;$(elms).each(function(index,el){var thisData=$(el).attr("guid")||$(el).attr("data");if(typeof thisData!="undefined"){query=query.replace("{guid}",thisData);muxArray.push({id:thisData,method:"count",q:query})}});jQuery.ajax({url:echoCountApi+JSON.stringify(muxArray),dataType:"jsonp",cache:true}).done(function(data,status){if(status!="error")$.each(data,function(index,el){var count=el.result!="error"?parseInt(el.count):"";var counterTarget=$(".echo-counter[guid\x3d'"+
index+"']");formatCount(count,counterTarget)})})};var formatCount=function(rawCount,uiTargets){for(i=0;i<uiTargets.length;i++)if(rawCount>=1E3&&uiTargets[i].classList.contains("format_short")){var shortCount=(Math.floor(10*(rawCount/1E3))/10).toFixed(1);uiTargets[i].innerHTML=shortCount+"k"}else uiTargets[i].innerHTML=rawCount};var resetFixed=function(data){var $shareBarHeight=$(".sticky-top-sharebar"),$streamHeader=$(".echo-apps-conversations-streamHeader");if(data=="opened"&&$(".bar-hidden").length===
0)$streamHeader.addClass("nav-open");else $streamHeader.removeClass("nav-open")};var init=function(){if(commentsClosed&&isArticle){$(".pb-f-page-comments").addClass("closed-message");$(".social-tools-wrapper-bottom").addClass("align-left").removeClass("align-right")}if(window.location.hash=="#comments")showComments();wp_pb.register("comments","showComments",showComments,this);wp_pb.register("comments","commentsReady",function(){if(forceShowComments==="1")showComments();if(window.location.hash=="#comments")$echoPlaceholder.parent()[0].scrollIntoView();
$($echoPlaceholder.parent()[0]).height("auto")});wp_pb.register("nav","finish_open",function(){resetFixed("opened")});wp_pb.register("nav","finish_close",function(){resetFixed("closed")});wp_pb.register("sticky-top-sharebar","sharebar_fixed",function(){$(".echo-apps-conversations-streamHeader").addClass("top-sharebar-fixed")});wp_pb.register("sticky-top-sharebar","sharebar_unfixed",function(){$(".echo-apps-conversations-streamHeader").removeClass("top-sharebar-fixed")});wp_pb.register("nav","menu_start_open",
function(){var $overlay=$(commentOverlay.overlayElements.overlay);if($overlay.length>0)$overlay.parent().hide()});wp_pb.register("nav","menu_finish_close",function(){var $overlay=$(commentOverlay.overlayElements.overlay);if($overlay.length>0)$overlay.parent().show()});wp_pb.register("comments","commentsMultiOpened",commentOverlay.onOpen);wp_pb.register("comments","commentsMultiClosed",commentOverlay.onClose);$(".comment-summary").click(function(){var data={elm:$(this),guid:$(this).find(".echo_container").attr("guid")};
history.pushState(null,null,"#comments");wp_pb.report("comments","showComments",data)});$(".comment-jump").click(function(){history.pushState(null,null,"#comments")});if(isMobile)$(".comment-summary.jump").hide();if(isMobile&&loadDeferredMobile||!isMobile&&triggerLoad)loadCommentCount(".echo-counter");else if(!isMobile&&loadDeferred){loadCommentCount(".echo-counter");$window.on("scroll.showComments",function(){if($window.scrollTop()/$echoPlaceholder.offset().top>=loadThreshhold)loadComments();if($window.scrollTop()>=
$echoPlaceholder.offset().top)showComments()})}else loadComments();if(triggerLoad){var triggerLoadLogger=new TWP.Tools.logger("LOAD-BLOCKER-COMMENTS");TWP.loadImmediatelyBlockers=TWP.loadImmediatelyBlockers||{};TWP.loadImmediatelyBlockers.comments=TWP.loadImmediatelyBlockers.comments||[];var checkCommentsBlockers=function(){triggerLoadLogger.log("checkCommentsBlockers: "+TWP&&TWP.loadImmediatelyBlockers&&TWP.loadImmediatelyBlockers.comments&&TWP.loadImmediatelyBlockers.comments.length!=0);return TWP&&
TWP.loadImmediatelyBlockers&&TWP.loadImmediatelyBlockers.comments&&TWP.loadImmediatelyBlockers.comments.length!=0};var loadCommentsLoader=function(forceAdd){if((!checkCommentsBlockers()||!!forceAdd)&&!!!TWP.loadImmediatelyBlockers.loadedComments){triggerLoadLogger.log("loadCommentsLoader");try{loadComments();TWP.loadImmediatelyBlockers.loadedComments=true}catch(err){}}};if(checkCommentsBlockers())$.each(TWP.loadImmediatelyBlockers.comments,function(i,val){$(window.document).on(val,function(){triggerLoadLogger.log("comments inEvent: "+
val);loadCommentsLoader()});setTimeout(function(){triggerLoadLogger.log("comments inTimeout");$(window.document).off(val);loadCommentsLoader(true)},5E3)});else{triggerLoadLogger.log("comments inElse");loadCommentsLoader(true)}}};return{init:init,showComments:showComments,loadCommentCount:loadCommentCount}}();wp_pb.CommentLoader.init()});