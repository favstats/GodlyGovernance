(function($){var __e=window.__e||[],logger=!!window.TWP&&!!TWP.Tools&&!!TWP.Tools.logger?new TWP.Tools.logger("pb-f-article-article-body"):window.console;var deviceWidth=window.innerWidth>0?window.innerWidth:screen.width;function Newsletter(){var defaultNewsLetter={frequency:"Daily",headline:"Get the Today's Headlines Newsletter",id:"post_newsletter1",name:"Today's Headlines",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-heads",variable:"vars[intent_heads]"},defaultNewsLetters=
[{frequency:"Daily",headline:"Get the Today's Headlines Newsletter",id:"post_newsletter1",name:"Today's Headlines",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-heads",variable:"vars[intent_heads]"},{frequency:"Daily",headline:"Get the Read In Newsletter",id:"post_newsletter112",name:"Read In",tagline:"Free daily updates delivered just for you.",template:"signup-confirm-readin",variable:"vars[intent_readin]"},{frequency:"Weekly",headline:"Get the Lean \x26 Fit Newsletter",
id:"post_newsletter8",name:"Lean \x26 Fit",tagline:"Free weekly updates delivered just for you.",template:"signup-confirm-lean",variable:"vars[intent_lean]"},{frequency:"Twice-weekly",headline:"Get the Checkpoint Newsletter",id:"post_newsletter130",name:"Checkpoint",tagline:"Free twice-weekly updates delivered just for you.",template:"signup-confirm-check",variable:"vars[intent_check]"}],subscribeEmail,washPostId,showNewsletter=function(){$("#signup-box-rr").show()},hideNewsletter=function(){$("#signup-box-rr").hide()},
showSignUpForm=function(){$("#newsletter-signUp-form").show();$("#newsletter-signUp-button").hide()},showSignUpButton=function(){$("#newsletter-signUp-form").hide();$("#newsletter-signUp-button").show()},showErrorMessage=function(message){if(message)$(".newsLetter-error-msg").text(message).show()},hideErrorMessage=function(){$(".newsLetter-error-msg").hide()},setNewsLetterValue=function(data){$("#newsletter-headline").append(data.headline);$("#newsletter-tagline").text(data.blurb)},setRecommendationsValues=
function(data){$(".suggestion-list .recommended").each(function(index){$(this).find("p").text(data[index].headline);$(this).find("input[type\x3d'checkbox']").attr("value",data[index].id);$(this).find("input[type\x3d'checkbox']").attr("name",data[index].name)})},toggleRecommendations=function(show){if(show){$("#newsletter-signUp-form, #newsletter-signUp-button, #newsletter-tagline").hide();$("#newsletter-suggestions-rr, #headline-checked, #subscribed-confirmation, #all-newsletters-lbl").show()}else $("#newsletter-suggestions-rr").hide()},
showSignUpConfirmation=function(){$("#newsletter-signUp-form, #newsletter-signUp-button, #newsletter-tagline").hide();$("#headline-checked, #subscribed-confirmation, #all-newsletters-lbl").show()},getUserId=function(){return document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:""},getWapoId=function(){return document.cookie.match(/wapo_secure_login_id=([^;]+)/)?RegExp.$1:""},getPageData=function(){var section=$("#newsletter-section").text(),subSection=$("#newsletter-subsection").text(),blog=$("#newsletter-blogname").text(),
data={};washPostId=getUserId();if(washPostId!=="")data.washPostId=washPostId;if(blog)data.blog=blog;if(subSection)data.subSection=subSection;if(section)data.section=section;return data},getMainNewsletter=function(){var data=getPageData();return $.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"https://recommendation-newsletter.wpdigital.net/Newsletter/api/newsletter",data:JSON.stringify(data)})},getRecommendations=function(newsletters){var data=getPageData();data.newsletters=
newsletters;return $.ajax({type:"POST",dataType:"json",contentType:"application/json",url:"https://recommendation-newsletter.wpdigital.net/Newsletter/api/newsletters",data:JSON.stringify(data)})},subscribe=function(email,recaptchaToken){var data,url;if(washPostId!==""){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe";data={wapoLoginID:washPostId,wapoSecureID:getWapoId(),userAgent:navigator.userAgent,newsletterName:window.Newsletter.id,metadata:[{name:"nl_start_method",value:"EI"},
{name:"nl_start_location",value:"RR"}]};if(recaptchaToken)data["recaptchaResponse"]=recaptchaToken}else if(email){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-email";data={email:email,newsletterName:window.Newsletter.id,metadata:[{name:"nl_start_method",value:"EI"},{name:"nl_start_location",value:"RR"}]};if(recaptchaToken)data["recaptchaResponse"]=recaptchaToken}$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:url,data:JSON.stringify(data),success:function(data){if(data.status==
"SUCCESS"){sendCustomTrackProps("event91",trackProps(window.Newsletter.name,1,"simple"),"Newsletter Right Rail Sign-up");setUpRecommendations(window.Newsletter.id)}},error:function(request,status,error){logger.info(error,"Error while subscribing")}})},subscribeBundle=function(){var data,url,newsletters=[],newsletterNames=[];$("#newsletter-suggestions-rr input:checked").each(function(){newsletters.push($(this).val());newsletterNames.push({name:$(this).attr("name"),position:$(this).attr("data-pos")})});
if(newsletters.length>0&&newsletterNames.length>0){if(washPostId!==""){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-list";data={wapoLoginID:washPostId,wapoSecureID:getWapoId(),userAgent:navigator.userAgent,newsletters:newsletters,metadata:[{name:"nl_start_method",value:"EA"},{name:"nl_start_location",value:"RR"}]}}else if(subscribeEmail){url="https://subscribe.washingtonpost.com/person/newsletter/subscribe-list-email";data={email:subscribeEmail,newsletters:newsletters,metadata:[{name:"nl_start_method",
value:"EA"},{name:"nl_start_location",value:"RR"}]}}$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:url,data:JSON.stringify(data),success:function(data){if(data.status=="SUCCESS"){for(var i=0;i<newsletterNames.length;i++)sendCustomTrackProps("event91",trackProps(newsletterNames[i].name,newsletterNames[i].position,"enhanced"),"Newsletter Right Rail Sign-up Bundle");setUpRecommendations(newsletters,true);toggleRecommendations(false)}},error:function(request,status,error){logger.info(error,
"Error while subscribing bundle")}})}},setUpRecommendations=function(newsletterId,confirmBundleSubscribe){var recommendations=getRecommendations([window.Newsletter.id]);recommendations.done(function(data){if(!$.isEmptyObject(data.newsletters)&&data.newsletters.length>=3&&!confirmBundleSubscribe){window.Newsletters=data.newsletters;setRecommendationsValues(data.newsletters);toggleRecommendations(true)}else toggleRecommendations(false);showSignUpConfirmation()});recommendations.fail(function(){if(!confirmBundleSubscribe){window.Newsletters=
defaultNewsLetters;setRecommendationsValues(defaultNewsLetters);toggleRecommendations(true)}})},setUpMainNewsletter=function(newsletter){window.Newsletter=newsletter;setNewsLetterValue(newsletter);showNewsletter();if(getUserId()!=="")showSignUpButton();else showSignUpForm()},applyRrNewsletters=function(){var mainNewsletter=getMainNewsletter();mainNewsletter.done(function(data){if(!$.isEmptyObject(data.newsletter))setUpMainNewsletter(data.newsletter);else hideNewsletter()});mainNewsletter.fail(function(){setUpMainNewsletter(defaultNewsLetter);
sendCustomTrackProps("event50",trackProps(defaultNewsLetter.name,1),"Newsletter Right Rail API failure case")});$("#newsletter-signUp-form").on("mouseover",function(){if(typeof grecaptcha==="undefined")$.ajax({url:"https://www.google.com/recaptcha/api.js",dataType:"script",cache:true,success:function(){var findCaptcha=setInterval(function(){if(typeof grecaptcha!=="undefined")clearInterval(findCaptcha)},50)},error:function(){}})});var captchaId;var email;var resetCaptcha=function(){if(captchaId)grecaptcha.reset();
$("#nlrecaptchadiv").html("");captchaId=grecaptcha.render("nlrecaptchadiv",{sitekey:"6Lf0DRoUAAAAAEawkoNEUKcpWx8eh_I7PRArTA9V",size:"invisible",callback:function(resp){logger.info("response key \x3d "+grecaptcha.getResponse(captchaId));$("#captchaDiv .text-success").show();setTimeout(function(){$("#captchaDiv .text-success").hide();$("#captchaDiv").hide()},5E3);subscribe(email,resp)}})};var captchaInitialized=0;$("#newsLetter-input").click(function(){if(!captchaInitialized){captchaInitialized=1;resetCaptcha($(this).html())}});
$(".subscribe-newsLetter").click(function(){var re=/[A-Z0-9._%+-]+@[A-Z0-9.-]+.[A-Z]{2,4}/gim;subscribeEmail=$("#newsLetter-input").val();if(this.id!=="newsletter-signUp-button"&&(subscribeEmail==""||!re.test(subscribeEmail)))showErrorMessage("Please enter a valid email address");else{hideErrorMessage();email=subscribeEmail;if(washPostId!=="")subscribe(subscribeEmail);else grecaptcha.execute(captchaId)}return false});$("#subscribe-bundle").click(function(){subscribeBundle()});$("#cancel-bundle").click(function(){sendCustomTrackProps("event58",
trackProps(),"No Thanks, Newsletter Right Rail Sign-up Bundle");$("#newsletter-suggestions-rr, #subscribed-confirmation").hide()})};function trackProps(newsletterName,index,enhancedKey){var subsection=window.wp_subsection||"";var contentType=window.wp_content_type||"";var channel=window.wp_channel||"";var props={eVar2:"wp - "+subsection,prop2:"wp - "+subsection,prop3:contentType,eVar17:contentType,channel:channel};if(newsletterName&&index)props.eVar26="nl_rightrail_"+enhancedKey+"_"+newsletterName.toLowerCase().split(" ").join("-")+
"_"+index;return props}function sendCustomTrackProps(eventKey,props,name){if(!!window.s)window.s.sendDataToOmniture(name||"PB Feature - Page-Newsletter",eventKey,props,{wait:true})}function initABTest(){var _dw=window._dw||[];_dw.push(["global","ready",function(api){if(deviceWidth>460)if(window.TWP.Data.Tracking.props.content_type=="front")applyRrNewsletters();else if(window.TWP.Data.Tracking.props.content_type=="blog"||window.TWP.Data.Tracking.props.content_type=="article"){var variant=api.get("newsletters-articleUnits");
if(!variant.is("banner")&&!variant.is("bottom"))applyRrNewsletters(variant)}else applyRrNewsletters()}])}this.init=function(){initABTest()}}var lifecycle={init:function(){var nl=new Newsletter;nl.init()}};if(wp_pb.StaticMethods.isPageHydrated())lifecycle.init();__e.push(["shamble",function(){lifecycle.init()}])})(jQuery);