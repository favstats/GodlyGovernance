(function(){var $=jQuery;var TWP=window.TWP||{};TWP.Perso=TWP.Perso||{};TWP.Perso.Tools=TWP.Perso.Tools||{};var T=TWP.Perso.Tools;var $sponsored=null;var $container=null;var $pbcontainer=null;var log=new TWP.Tools.logger("HYBRID");var validOnes=[];var clientString="recommend-strip-11";if(window["wp_meta_data"]&&window["wp_meta_data"]["isPWA"])clientString+="-pwa";try{var client=new TWP.Perso.Recommend(clientString,3)}catch(e){}var counterPointApi=null;var canonicalPage=document.querySelectorAll("link[rel\x3dcanonical]")[0];
var counterPointUrl="";var status="";var visible=false;var clickListenerAdded=false;var trackRenderedAllCalled=false;function _failure(error){log.debug("Failure",function(){$pbcontainer.hide();trackError(error);status="failed"})}function isValid(recommendation){return recommendation&&recommendation.url&&recommendation.responsetype&&recommendation.headline&&recommendation.summary&&recommendation.photo&&recommendation.photo.path}function render(recommendations){if(!recommendations||recommendations.length==
0)return _failure("no-recommendations");validOnes=[];for(var i=0;i<recommendations.length;i++)if(isValid(recommendations[i]))validOnes.push(recommendations[i]);if(validOnes.length==0)return _failure("no-valid-recommendations");log.debug("Render",function(){_renderArticle(validOnes)});status="rendered";trackVisible()}function initModal($container){var modal=$container.find(".story-label-explainer");modal.jqm({overlayClass:"story-label-explainer",closeClass:"label-modal-close",overlay:0,onHide:function(hash){hash.w.hide()&&
hash.o&&hash.o.remove();return true}});$container.find(".section-label-span").hover(function(){modal.jqmShow()});$(document).mouseup(function(e){if(!modal.is(e.target)&&modal.has(e.target).length===0)modal.jqmHide()});if(typeof window.Hammer==="function"&&wp_pb.BrowserInfo.mobile_browser)try{var hammertime=new window.Hammer($(".section-label-span")[0],{prevent_mouseevents:true});hammertime.on("tap",handleTap)}catch(err){log.debug(err)}function handleTap(ev){ev.gesture.preventDefault();ev.gesture.stopPropagation();
modal.jqmShow()}}function _renderArticle(recommendations){var idx=0;var html="";var counterHtml="";var classes="";for(var i=0;i<recommendations.length;i++)if(recommendations[i].responsetype==="hybrid_counterpoint_1_na"){log.debug("Render item ("+i+")");counterHtml=counterHtml+renderItem(recommendations[i],idx,recommendations.length);idx=idx+1}else{log.debug("Render item ("+i+")");html=html+renderItem(recommendations[i],idx,recommendations.length);idx=idx+1}html=renderRecHtml(html,classes,"The Post Recommends");
$sponsored=$("#slug_postrecommends");$sponsored.remove();if(counterHtml.length>0){counterHtml=renderRecHtml(counterHtml,"counterpoint","Counterpoint");$container.html(counterHtml);$container.append(html)}else $container.html(html);initModal($container);$container.find(".content-strip \x3e .label-wrapper").before($sponsored);$container.show();$pbcontainer.show();$pbcontainer.after('\x3cdiv class\x3d"clear"\x3e\x3c/div\x3e');$(document).trigger("dom-manipulation-complete")}function renderRecHtml(html,
classes,label){var modal="";var modalLabel="";var counterpointLabel="";if(label==="Counterpoint"){modal='\x3cdiv class\x3d"story-label-explainer arrow_box"\x3e'+'\x3ci class\x3d"fa fa-times label-modal-close" aria-hidden\x3d"true"\x3e\x3c/i\x3e'+'\x3cp class\x3d"label-title Counterpoint"\x3e'+'\x3cb class\x3d"label"\x3eCounterpoint\x3c/b\x3e '+'\x3cspan class\x3d"label-content"\x3eAn Opinions piece that offers a different perspective from the article you\u2019re currently reading\x3c/span\x3e'+"\x3c/p\x3e"+
"\x3c/div\x3e";modalLabel="section-label-span";counterpointLabel='\x3cspan class\x3d"counterpoint-explainer"\x3e\x3ci class\x3d"fa fa-circle counterpoint-label-ic" aria-hidden\x3d"true"\x3e\x3c/i\x3e A different view on the issue\x3c/span\x3e'}return'\x3cdiv class\x3d"postrecommends contentfeed '+classes+'"\x3e'+'\x3cdiv class\x3d"content-strip"\x3e'+'\x3cdiv class\x3d"label-wrapper label-wrapper-post-recommends"\x3e'+'\x3cspan class\x3d"label label-kicker"\x3e\x3cspan class\x3d"'+modalLabel+'"\x3e'+
label+"\x3c/span\x3e\x3c/span\x3e"+counterpointLabel+modal+"\x3c/div\x3e"+'\x3cdiv class\x3d"clear"\x3e\x3c/div\x3e'+html+'\x3cdiv class\x3d"clear"\x3e\x3c/div\x3e'+"\x3c/div\x3e"+"\x3c/div\x3e"}function renderURL(recommendation){return recommendation.url+"?tid\x3d"+recommendation.responsetype}function renderImgURL(recommendation,w,h){var url=recommendation.photo.path;var re1=/(washingtonpost.com\/rf\/image_[^/]+\/)/;var re2=/(washingtonpost.com\/rw?\/)/;if(url.match(re1)||url.match(re2))url=url.replace(RegExp.$1,
"washingtonpost.com/rf/image_"+w+"x"+h+"/");else url="https://www.washingtonpost.com/wp-apps/imrs.php?src\x3d"+encodeURIComponent(url)+"\x26w\x3d"+w+"\x26h\x3d"+h;return url}function renderClasses(recommendation,index,total){var classes="";if(recommendation.responsetype.match(/video/))classes=classes+"video ";if(index==0)classes=classes+"first ";if(index==total-1)classes=classes+"last";return classes}function renderItem(recommendation,index,total){var node=$($("#postrecommends-article-template").html());
node.addClass(renderClasses(recommendation,index,total));var headline=node.find(".headline a");headline.html(recommendation.headline);headline.attr("href",renderURL(recommendation));var labelWrapper=node.find(".label-wrapper");var label=node.find(".label");if(recommendation["storyType"])label.text(recommendation["storyType"]);else labelWrapper.remove();var linkImg=node.find(".photo-wrapper a");linkImg.attr("href",renderURL(recommendation));var blurb=node.find(".blurb");blurb.html(recommendation.summary);
var displayDate=recommendation.displayDate||recommendation.publishedAt;if(displayDate){displayDate=wp_pb.StaticMethods.getTwitterTime(displayDate);blurb.after('\x3cdiv class\x3d"timestamp"\x3e'+displayDate+"\x3c/div\x3e")}var img='\x3cimg alt\x3d"" src\x3d"'+renderImgURL(recommendation,480,320)+'"'+' data-hi-res-src\x3d"'+renderImgURL(recommendation,480,320)+'"'+' data-low-res-src\x3d"'+renderImgURL(recommendation,112,75)+'"'+' data-threshold\x3d"112" class\x3d"courtesy-of-the-resizer"\x3e';node.find(".photo-wrapper img").replaceWith(img);
if(recommendation.responsetype.match(/video/)){var time="";if(recommendation.videoDuration&&recommendation.videoDuration>1E3){var seconds=Math.floor(recommendation.videoDuration/1E3);var minutes=Math.floor(seconds/60);seconds=seconds%60;if(seconds<10)seconds="0"+seconds.toString();time=minutes+":"+seconds}var caption='\x3cdiv class\x3d"standalone-overlay posttv-playlist-text-play-btn"\x3e'+'\x3ca class\x3d"video-play" href\x3d"'+renderURL(recommendation)+'"\x3e'+'\x3cspan class\x3d"fa fa-play icon-left"\x3e\x3c/span\x3e\x3cspan\x3ePlay Video\x3c/span\x3e'+
'\x3cspan class\x3d"duration"\x3e'+time+"\x3c/span\x3e"+"\x3c/a\x3e"+"\x3c/div\x3e";blurb.after(caption)}return node[0].outerHTML}function clickTracker(ev){var link=this;var mClick=ev.button>0||ev.ctrlKey||ev.metaKey||ev.shiftKey;var prefetched=$(link).hasClass("pre-fetched");log.debug("Click",function(){var href=link.href;var tid=href.replace(/.*\?tid=/,"");log.debug("URL : "+href);trackClicked(client,href,tid);var newHref=href;newHref=newHref.replace(/.*wpprivate.com\/pb/,"https://www.washingtonpost.com");
newHref=newHref.replace(/.*localhost:8888\/pb/,"https://www.washingtonpost.com");if(newHref.split("?")[0]===counterPointUrl.href)serveCounterStats("clicked");if(mClick||prefetched);else setTimeout(function(){log.debug("Redirecting");document.location=href},200)});return mClick||prefetched}function trackClicks(){if(!clickListenerAdded){clickListenerAdded=true;$pbcontainer.on("click",".row a",null,clickTracker)}}function trackClicked(client,url,tid){T.Omniture.send("post_recommends","",{prop69:tid},
log);client.clicked(url)}function trackVisible(){if(status=="rendered"&&visible&&!trackRenderedAllCalled){trackRenderedAllCalled=true;var param=[];for(var i=0;i<validOnes.length;i++){param.push(validOnes[i].responsetype);if(validOnes[i].responsetype==="hybrid_counterpoint_1_na"){var parser=document.createElement("a");parser.href=validOnes[i].url;counterPointUrl=parser;serveCounterStats("served")}}var props={prop72:param.join(",")};T.Omniture.send("post_recommends","",props,log);client.rendered()}}
function serveCounterStats(type){var parsedOpinion=document.createElement("a");parsedOpinion.href=canonicalPage.href;var opinionUrl=parsedOpinion.pathname;var params="opinion_url\x3d"+opinionUrl+"\x26counterpoint_url\x3d"+counterPointUrl.pathname+"\x26stype\x3d"+type;var sReq=new XMLHttpRequest;sReq.open("POST",counterPointApi,true);sReq.setRequestHeader("Content-type","application/x-www-form-urlencoded");sReq.send(params)}function trackError(){}function _preload(){log.debug("Setting up click handlers");
trackClicks();log.debug("Requesting recommendations");client.recommend().done(function(data){render(data["results"])})}function _visible(){log.debug("Visible",function(){visible=true;trackVisible()})}function _init(){log.debug("DOM Ready",function(){try{log.debug("(Re)Init variables");status="";visible=false;trackRenderedAllCalled=false;counterPointApi=wp_pb.recommendationEnv&&wp_pb.recommendationEnv.COUNTERPOINT_API;log.debug("Finding containers");$container=$("#post-recommends");$container.hide();
if(!$pbcontainer||$pbcontainer.length==0)$pbcontainer=$container.parent();if($container.length==1){log.debug("Setting up scroll listener");if(document.location.toString().match(/\/lifestyle\/kidspost\//)){T.Events.smartPreload($pbcontainer,{});$pbcontainer.hide()}else T.Events.smartPreload($pbcontainer,{preload:_preload,visible:_visible,screens:2})}}catch(e){trackError("init-error")}})}if(wp_pb.StaticMethods.isPageHydrated())$(function(){_init()});var shambleEvent=window.__e;shambleEvent.push(["shamble",
function(){_init()}])})();