(function(){var TWP=window.TWP||{};TWP.Perso=TWP.Perso||{};TWP.Perso.Tools=TWP.Perso.Tools||{};var T=TWP.Perso.Tools;var hostBase=null;var clickedEndpoint=null;var renderedEndpoint=null;var recommendEndpoint=null;var canonical=document.querySelectorAll("link[rel\x3dcanonical]")[0];function isVideoUser(){if(videoUser==null){var videoUser=false;var videoUUIDs=[];var videos=T.store.getJSONItem("twpVideoHistory");if(videos)for(var uuid in videos)if(videos.hasOwnProperty(uuid)){videoUUIDs.push(uuid);var timestamp=
videos[uuid].timestamp;if(timestamp>Date.now()-3600*1E3)videoUser=true}if(T.store.getJSONItem("usersegments","segmentsFlag.9013442807"))videoUser=true}return{videoUser:videoUser,videoUUIDs:videoUUIDs}}function baseParams(client,count){var params={};params.url=canonical.href;params.referrer=document.referrer;params.count=count;params.client=client;try{params.svi=localStorage.getItem("wp_vi")}catch(e){params.svi=null}params.s2281234048=T.store.getJSONItem("usersegments","segmentsFlag.2281234048");params.s2582021445=
T.store.getJSONItem("usersegments","segmentsFlag.2582021445");params.isInfluencer=T.store.getJSONItem("usersegments","segmentsFlag.2348060805");var _dw=window._dw||[];_dw.push(["global","ready",function(api){var variant=api.get("recommendation-influencersexperiments");params.isInfluencerContent=variant.is("influencers")}]);var exclude=[];var readlist=T.store.getJSONItem("readlist");if(readlist&&readlist.length)for(var i=0;i<readlist.length;i++){var readUrl=readlist[i]["u"];if(readUrl)exclude.push(readUrl)}params.exclude=
exclude;var video=isVideoUser();params.video=video.videoUser;params.videoUUIDs=video.videoUUIDs.join("|");return params}function slimResponse(response){var slim={uuid:"",results:[]};if(response){slim.uuid=response.uuid;if(response.results)for(var i=0;i<response.results.length;i++)slim.results.push({url:response.results[i].url,responsetype:response.results[i].responsetype})}return slim}function ajaxCall(url,payload){var promise=jQuery.Deferred();jQuery.ajax(url,{contentType:"application/json",processData:false,
dataType:"json",type:"POST",data:JSON.stringify(payload)}).done(function(data){promise.resolve(data)}).fail(function(jqXHR,textStatus,error){if(error.toString().match(/(Access is denied|No Transport)/))jQuery.ajax(url,{contentType:"application/json",dataType:"jsonp",type:"GET",data:{query:JSON.stringify(payload)}}).done(function(data){promise.resolve(data)}).fail(function(jqXHR,textStatus,error){promise.reject(jqXHR,textStatus,error)});else promise.reject(jqXHR,textStatus,error)});return promise}
function Recommend(client,count){hostBase=window.wp_pb&&window.wp_pb.recommendationEnv&&window.wp_pb.recommendationEnv.REC_API||"https://recommendation-hybrid.wpdigital.net/hybrid/hybrid-filter";clickedEndpoint=hostBase+"/clicked";renderedEndpoint=hostBase+"/rendered";recommendEndpoint=hostBase+"/recommend";this.client=client;this.count=count}Recommend.prototype={recommend:function(){var self=this;return ajaxCall(recommendEndpoint,baseParams(this.client,this.count)).done(function(response){self.response=
slimResponse(response)})},rendered:function(){var params=baseParams(this.client,this.count);params.response=this.response;return ajaxCall(renderedEndpoint,params)},clicked:function(url){var params=baseParams(this.client,this.count);params.response=this.response;params.clickUrl=url;return ajaxCall(clickedEndpoint,params)}};TWP.Perso.Recommend=Recommend})();