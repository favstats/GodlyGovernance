(function($,window){var svi="NA";try{var sviFull=document.cookie.match(/s_vi=([^;]+)/)?RegExp.$1:false;if(sviFull&&sviFull!==""){svi=sviFull.replace(/.*\|/,"").replace(/\[.*/,"").split("-");svi=svi[0]+"-"+svi[1]}}catch(e){}var wapoId=document.cookie.match(/wapo_login_id=([^;]+)/)?RegExp.$1:"NA";function saveKeyValue(key,value){try{var segments=localStorage.getItem("usersegmentsAdops")||"{}";segments=JSON.parse(segments);segments[key]=value;localStorage.setItem("usersegmentsAdops",JSON.stringify(segments))}catch(e){}}
function setAdopsData(data){var value=null;if(data&&data.segmentsFlag){value=data.segmentsFlag["7978704408"];if(value=="8936"){saveKeyValue("8936",1);saveKeyValue("9868",0);saveKeyValue("6136",0)}else if(value=="9868"){saveKeyValue("8936",0);saveKeyValue("9868",1);saveKeyValue("6136",0)}else if(value=="6136"){saveKeyValue("8936",0);saveKeyValue("9868",0);saveKeyValue("6136",1)}else{saveKeyValue("8936",0);saveKeyValue("9868",0);saveKeyValue("6136",0)}value=data.segmentsFlag["5497328667"];if(value==
"7204"){saveKeyValue("7204",1);saveKeyValue("0862",0);saveKeyValue("2467",0);saveKeyValue("0668",0)}else if(value=="0862"){saveKeyValue("7204",0);saveKeyValue("0862",1);saveKeyValue("2467",0);saveKeyValue("0668",0)}else if(value=="2467"){saveKeyValue("7204",0);saveKeyValue("0862",0);saveKeyValue("2467",1);saveKeyValue("0668",0)}else{saveKeyValue("7204",0);saveKeyValue("0862",0);saveKeyValue("2467",0);saveKeyValue("0668",1)}var segments=["808","809","810"];var thresholds=["H","M","L"];for(var is=0;is<
segments.length;is++)for(var it=0;it<thresholds.length;it++){value=data.segmentsFlag["9013442"+segments[is]];if(value&&value.toUpperCase()==thresholds[it])saveKeyValue(segments[is]+"_"+thresholds[it],1);else saveKeyValue(segments[is]+"_"+thresholds[it],0)}var newsletters=["6362","3552","3433","7543","8636","5723","2748","3522","5263"];var list=[];value=data.segmentsFlag["1599213719"];if(value&&value.length>0)list=value.split(",");for(var i=0;i<newsletters.length;i++){var nl=newsletters[i];if(list.indexOf(nl)>
-1)saveKeyValue(nl,1);else saveKeyValue(nl,0)}}}function getUserSegments(){var update=true;try{var segments=JSON.parse(localStorage.getItem("usersegments"));var updatedAt=(new Date(segments.updated)).getTime();if(Date.now()-updatedAt<3600*1E3)update=false}catch(e){}if(update)$.ajax("https://usersegment.wpdigital.net/usersegments",{type:"POST",dataType:"json",processData:false,contentType:"application/json",data:JSON.stringify({userid:svi})}).done(function(data){setAdopsData(data);data.updated=new Date;
localStorage.setItem("usersegments",JSON.stringify(data))})}function normalizeURL(url,removeTrailingSlash){var str=(url||"").trim();str=str.replace(/^(https?:)?\/\//,"");str=str.replace(/[?#].*/,"");if(removeTrailingSlash)str=str.replace(/\/$/,"");return str}function extractQueryParam(param){var rgx=new RegExp(".*[?\x26]"+param+"\x3d([^\x26]+).*");if(rgx.test(document.location.toString()))return document.location.toString().replace(rgx,"$1");else return""}function callTargeting(){var meta=window["wp_meta_data"];
var auxiliaries=meta&&meta.clavis&&meta.clavis.auxiliaries||[];var canonicalUrl=$('link[rel\x3d"canonical"]').attr("href");if(!canonicalUrl)canonicalUrl=[window.location.host,window.location.pathname].join("");var loxodoId="NA";try{loxodoId=localStorage.getItem("wp_vi")||"NA"}catch(e){}var contentType="";try{contentType=TWP.Data.Tracking.props.content_type}catch(e){}var usersegments=null;try{usersegments=JSON.parse(localStorage.getItem("usersegments"))}catch(e){}var metadata=window.wp_meta_data||
null;if(metadata){metadata=JSON.parse(JSON.stringify(metadata));var ctype=metadata["contentType"];if(ctype==""||ctype===null||ctype===false||typeof ctype=="undefined")metadata["contentType"]=[];else metadata["contentType"]=[].concat(ctype)}var dataPayload={articleid:normalizeURL(canonicalUrl,true),referrer:normalizeURL(document.referrer),uuid:svi,userid:loxodoId,wapo_login_id:wapoId,auxiliaries:auxiliaries,contentType:contentType,wp_meta_data:metadata,usersegments:usersegments,tid:extractQueryParam("tid"),
wpisrc:extractQueryParam("wpisrc"),isMobile:window.isMobile&&window.isMobile.any()};$.ajax({url:"https://targeting.washpost.nile.works/TargetingWebAPP/targeting",type:"POST",contentType:"application/json",dataType:"JSON",data:JSON.stringify(dataPayload)}).done(function(response){var auxMap=response.aux_map&&response.aux_map.join(",");if(auxMap)localStorage.setItem("targeting_aux_map",auxMap);else localStorage.setItem("targeting_aux_map","")})}if(wp_pb.StaticMethods.isPageHydrated()){getUserSegments();
callTargeting()}var shambleEvent=window.__e;shambleEvent.push(["shamble",function(){getUserSegments();callTargeting()}])})(jQuery,window);